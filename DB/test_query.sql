USE fleet_db
GO

DECLARE @token varbinary(64)
EXECUTE PROC_AUTHORIZE @input_username = 'user2', @input_passwd = 'Fall2021'
SELECT @token

SELECT * FROM CONF_SESSIONS

DELETE FROM CONF_SESSIONS WHERE 1=1

EXEC PROC_CLOSE_SESSION @token=0x5051211491916AB65C1BCB9A85B749086B2DFC2563278D672C2359ADDF9E89752F0CA44E0E282BB68CDFC92B31E72BD451B12F476463133F418E322AC176C8F9
GO

DECLARE @token varbinary(64)
SET @token=0x825E358B05A74D35F81D600DB03F485EB5D5DD8D3BB1769105A9E0608C601B48C3083AE6DB23D269F96515CA55D03C56D607C88A26A8891CA450EAB16CADCE15
DECLARE @input_username nvarchar(30)
SET @input_username=NULL

IF @input_username IS NULL
BEGIN
	SELECT @input_username= username FROM CONF_SESSIONS WHERE sessionID=@token
	PRINT 'XDD'
END
PRINT @input_username
GO

USE fleet_db
GO
SELECT * FROM COMP_PROFILES
SELECT * FROM CONF_SESSIONS
SELECT * FROM USERS_CRED
SELECT * FROM USERS_PROFILES
SELECT * FROM CARS
SELECT * FROM CAR_SERVICES
SELECT * FROM [SERVICES] ORDER BY service_id
SELECT * FROM REPAIR_HISTORY


SELECT *
FROM USERS_PROFILES
JOIN COMP_PROFILES ON USERS_PROFILES.company=COMP_PROFILES.name

SELECT *
FROM USERS_CRED c 
JOIN USERS_PROFILES p ON c.username=p.username

SELECT p.company
FROM CONF_SESSIONS c
JOIN USERS_PROFILES p ON c.username=p.username
WHERE c.sessionID=@token


USE fleet_db
GO
SELECT first_name, last_name, company FROM USERS_PROFILES WHERE username='admin'

SELECT first_name, last_name, company FROM USERS_PROFILES p 
JOIN CONF_SESSIONS c ON p.username=c.username 
WHERE c.sessionID=0x04A4A5DC43C30AAFAED0D11B5F7AC9DD6B8DA50F8E1A37FE7A386C5555870FECB4381A4E455E036D0A86120BAE9DE863362CBBBD79DFBF46F939D0F77EE0BC5E
GO


DECLARE @token varbinary(64)
SET @token = 0xC2634AC0CB22BC728FF4DC7ADE42FCD85BDF15D92696F027FE134EB52B1596235DC3C6A547D158F39272D3FBE1F9E6F68C0169D855F357CB0F03B297B65594FF
DECLARE @input_name nvarchar(60)
SET @input_name = NULL

IF @input_name IS NULL
BEGIN
	PRINT 'poszlo'
	DECLARE @user nvarchar(30)
	SELECT @user = p.company FROM CONF_SESSIONS c 
		JOIN USERS_PROFILES p ON c.username=p.username WHERE c.sessionID=@token
	SELECT @input_name = company FROM USERS_PROFILES WHERE username=@user
	PRINT @input_name
END


DECLARE @sql nvarchar(200)
	
SET @input_name = LTRIM(RTRIM(@input_name))

SET @sql = N'USE fleet_db '
			+ N'SELECT * FROM COMP_PROFILES WHERE [name] = ''' + @input_name + ''''
EXEC sp_sqlexec @sql
GO



DECLARE @token varbinary(64)
SET @token = 0xC2634AC0CB22BC728FF4DC7ADE42FCD85BDF15D92696F027FE134EB52B1596235DC3C6A547D158F39272D3FBE1F9E6F68C0169D855F357CB0F03B297B65594FF

SELECT company FROM USERS_PROFILES u
JOIN CONF_SESSIONS s ON u.username=s.username
WHERE s.sessionID=@token



SELECT u.username, u.first_name, u.last_name, u.company, u.position, u.photo_url, u.phone, u.mail, c.brand, c.model 
FROM USERS_PROFILES u 
JOIN CARS c ON u.car_plate=c.plate_number
WHERE username='admin'



USE fleet_db
GO
SELECT username, first_name, last_name, company, position, photo_url, phone, mail 
FROM USERS_PROFILES WHERE username='admin'
 
EXEC PROC_GET_USER_PROFILE @token=0x6FFE4698BF0735A84823BBC78808837EBAEF21E549AF2E326586CEFCA35B70A16CABE6142278412E9355592EB834FD18C52AE7C0BE258D75F3D0D24ABF5F4555, @input_username='admin'
EXEC PROC_GET_CAR_PROFILE @token=0x16A4A2B252003EE9FFE0213988B973B15360B146CFD0B9C11B8663E3EF4BC6877AD46534082F02640845177173E471B071DE54834D1BAAAF488CB7EC979C27F0
EXEC PROC_GET_CARS_LIST @token=0x16A4A2B252003EE9FFE0213988B973B15360B146CFD0B9C11B8663E3EF4BC6877AD46534082F02640845177173E471B071DE54834D1BAAAF488CB7EC979C27F0
EXEC PROC_GET_CAR_SERVICE @token=0x28E0D399442A5AB2F22096FDF07550214DB5F77124D0304B4084522E9F9B7F04CEB193C8F7EBD8CA73CEBCF50522F5036DABF8D130EA043ADBD6E757303E759F, @input_id = 2
EXEC PROC_GET_CAR_SERVICES_LIST @token=0x28E0D399442A5AB2F22096FDF07550214DB5F77124D0304B4084522E9F9B7F04CEB193C8F7EBD8CA73CEBCF50522F5036DABF8D130EA043ADBD6E757303E759F
SELECT * FROM CARS

SELECT c.*, u.car_plate FROM CARS c 
JOIN USERS_PROFILES u ON C.car_id = u.car_id


SELECT u.car_plate, c.* FROM USERS_PROFILES u
JOIN CARS c ON u.car_id = c.car_id
WHERE u.car_plate = 'WX00051'


SELECT u.company FROM CONF_SESSIONS s
JOIN USERS_PROFILES u ON s.username = u.username
WHERE s.sessionID = 0xB999D5893BF0565CC52BCBE8A712891D6A157A4E9681E6544E9E8EB4F17D27DE9277EDD95A9D0DCA69869456806A6483E787CB190DC245BD19D54FCEE77D4144

SELECT first_name, last_name, position, username FROM USERS_PROFILES
WHERE company = N'Macrosoft'

SELECT * FROM CARS
ORDER BY brand, model, prod_year


SELECT * FROM CAR_SERVICES
WHERE car_service_id = 1

--0x28E0D399442A5AB2F22096FDF07550214DB5F77124D0304B4084522E9F9B7F04CEB193C8F7EBD8CA73CEBCF50522F5036DABF8D130EA043ADBD6E757303E759F
SELECT u.car_plate FROM USERS_PROFILES u
JOIN CONF_SESSIONS c ON u.username = c.username
WHERE c.sessionID = 0x28E0D399442A5AB2F22096FDF07550214DB5F77124D0304B4084522E9F9B7F04CEB193C8F7EBD8CA73CEBCF50522F5036DABF8D130EA043ADBD6E757303E759F
EXEC PROC_INSERT_REPAIR_HISTORY @token=0x28E0D399442A5AB2F22096FDF07550214DB5F77124D0304B4084522E9F9B7F04CEB193C8F7EBD8CA73CEBCF50522F5036DABF8D130EA043ADBD6E757303E759F, @service_id=2, @car_service_id=1, @date= '20220109'
SELECT CONVERT(varchar, GETDATE(), 23)
SELECT CONVERT(datetime, '2012-04-06T12:23:45')

SELECT * FROM REPAIR_HISTORY
INSERT INTO REPAIR_HISTORY (plate_number, service_id, car_service_id, [date])
VALUES ('WX00001', 3, 3, '2012-04-06T12:23:45')
INSERT INTO REPAIR_HISTORY (plate_number, service_id, car_service_id, [date])
VALUES ('WX00001', 3, 3, '2012-04-06')





/* Usuwanie tabel */
/*	
USE fleet_db
GO
DROP TABLE CONF_SESSIONS
DROP TABLE USERS_PROFILES
DROP TABLE CARS
DROP TABLE COMP_PROFILES
DROP TABLE USERS_CRED
*/
/* Wyswietlanie tabel */
/*
USE fleet_db
GO
SELECT * FROM COMP_PROFILES
SELECT * FROM CONF_SESSIONS
SELECT * FROM USERS_CRED
SELECT * FROM USERS_PROFILES
SELECT * FROM CARS
*/